{"version":3,"file":"settings.min.js","sources":["../src/settings.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module assignsubmission_onlyoffice/settings\n * @copyright  2025 Ascensio System SIA <integration@onlyoffice.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n **/\ndefine([\n    'core/notification',\n    'assignsubmission_onlyoffice/repository'\n], function(Notification, repository) {\n    const editorId = 'onlyoffice-editor';\n    let docEditor = null;\n\n    const openEditor = function(contextid, key, format, templatetype) {\n        closeEditor();\n        repository.buildSettingsEditorConfig(contextid, key, format, templatetype).then(config => {\n            const editorConfig = JSON.parse(config);\n            // eslint-disable-next-line no-undef\n            docEditor = new DocsAPI.DocEditor(editorId, editorConfig);\n            return;\n        }).catch(error => {\n            // eslint-disable-next-line no-console\n            console.error('Error building editor config:', error);\n        });\n    };\n\n    const closeEditor = function() {\n        if (docEditor) {\n            docEditor.destroy();\n            docEditor = null;\n        }\n    };\n\n    const generateUniqueId = () => {\n        return Math.floor(Date.now() / 1000).toString(16) +\n               Math.floor(Math.random() * 1000).toString(16);\n    };\n\n    return {\n        init: function(contextid) {\n            // eslint-disable-next-line no-undef\n            if (typeof DocsAPI === \"undefined\" && DocsAPI === null) {\n                Notification.error('Document Server is not defined!');\n                return;\n            }\n\n            const selectformat = document.querySelector('select[id=\"id_assignsubmission_onlyoffice_format\"]');\n            const selecttemplatetype = document.querySelector('select[id=\"id_assignsubmission_onlyoffice_template_type\"]');\n            const enabletoggleelement = document.querySelector('input[id=\"id_assignsubmission_onlyoffice_enabled\"]');\n            const templatekeyelement = document.querySelector(\"input[name='assignsubmission_onlyoffice_tmplkey']\");\n            const originalformat = selectformat.value;\n            const originaltemplatekey = templatekeyelement.value;\n\n            if (enabletoggleelement.checked && selecttemplatetype.value === 'custom') {\n                openEditor(\n                    contextid,\n                    templatekeyelement.value,\n                    selectformat.value,\n                    selecttemplatetype.value\n                );\n            }\n\n            enabletoggleelement.addEventListener('change', function(e) {\n                if (e.currentTarget.checked\n                    && selectformat.value !== 'upload'\n                    && selecttemplatetype.value === 'custom'\n                ) {\n                    if (docEditor === null) {\n                        openEditor(\n                            contextid,\n                            templatekeyelement.value,\n                            selectformat.value,\n                            selecttemplatetype.value\n                        );\n                    }\n                }\n            });\n\n            selectformat.addEventListener('change', async function(e) {\n                if (e.currentTarget.value !== 'upload' && selecttemplatetype.value === 'custom') {\n                    if (e.currentTarget.value === originalformat) {\n                        templatekeyelement.value = originaltemplatekey;\n                    } else {\n                        templatekeyelement.value = generateUniqueId();\n                    }\n\n                    openEditor(\n                        contextid,\n                        templatekeyelement.value,\n                        selectformat.value,\n                        selecttemplatetype.value\n                    );\n                } else {\n                    closeEditor();\n                }\n            });\n\n            selecttemplatetype.addEventListener('change', function(e) {\n                if (e.currentTarget.value === 'custom' && selectformat.value !== 'upload') {\n                    openEditor(\n                        contextid,\n                        templatekeyelement.value,\n                        selectformat.value,\n                        e.currentTarget.value\n                    );\n                } else {\n                    closeEditor();\n                }\n            });\n        }\n    };\n});\n"],"names":["define","Notification","repository","docEditor","openEditor","contextid","key","format","templatetype","closeEditor","buildSettingsEditorConfig","then","config","editorConfig","JSON","parse","DocsAPI","DocEditor","catch","error","console","destroy","init","selectformat","document","querySelector","selecttemplatetype","enabletoggleelement","templatekeyelement","originalformat","value","originaltemplatekey","checked","addEventListener","e","currentTarget","async","Math","floor","Date","now","toString","random"],"mappings":";;;;;AAoBAA,8CAAO,CACH,oBACA,2CACD,SAASC,aAAcC,gBAElBC,UAAY,WAEVC,WAAa,SAASC,UAAWC,IAAKC,OAAQC,cAChDC,cACAP,WAAWQ,0BAA0BL,UAAWC,IAAKC,OAAQC,cAAcG,MAAKC,eACtEC,aAAeC,KAAKC,MAAMH,QAEhCT,UAAY,IAAIa,QAAQC,UARf,oBAQmCJ,iBAE7CK,OAAMC,QAELC,QAAQD,MAAM,gCAAiCA,WAIjDV,YAAc,WACZN,YACAA,UAAUkB,UACVlB,UAAY,aASb,CACHmB,KAAM,SAASjB,cAEY,oBAAZW,SAAuC,OAAZA,oBAClCf,aAAakB,MAAM,yCAIjBI,aAAeC,SAASC,cAAc,sDACtCC,mBAAqBF,SAASC,cAAc,6DAC5CE,oBAAsBH,SAASC,cAAc,sDAC7CG,mBAAqBJ,SAASC,cAAc,qDAC5CI,eAAiBN,aAAaO,MAC9BC,oBAAsBH,mBAAmBE,MAE3CH,oBAAoBK,SAAwC,WAA7BN,mBAAmBI,OAClD1B,WACIC,UACAuB,mBAAmBE,MACnBP,aAAaO,MACbJ,mBAAmBI,OAI3BH,oBAAoBM,iBAAiB,UAAU,SAASC,GAChDA,EAAEC,cAAcH,SACU,WAAvBT,aAAaO,OACgB,WAA7BJ,mBAAmBI,OAEJ,OAAd3B,WACAC,WACIC,UACAuB,mBAAmBE,MACnBP,aAAaO,MACbJ,mBAAmBI,UAMnCP,aAAaU,iBAAiB,UAAUG,eAAeF,GACrB,WAA1BA,EAAEC,cAAcL,OAAmD,WAA7BJ,mBAAmBI,OACrDI,EAAEC,cAAcL,QAAUD,eAC1BD,mBAAmBE,MAAQC,oBAE3BH,mBAAmBE,MAjD5BO,KAAKC,MAAMC,KAAKC,MAAQ,KAAMC,SAAS,IACvCJ,KAAKC,MAAsB,IAAhBD,KAAKK,UAAiBD,SAAS,IAmDrCrC,WACIC,UACAuB,mBAAmBE,MACnBP,aAAaO,MACbJ,mBAAmBI,QAGvBrB,iBAIRiB,mBAAmBO,iBAAiB,UAAU,SAASC,GACrB,WAA1BA,EAAEC,cAAcL,OAA6C,WAAvBP,aAAaO,MACnD1B,WACIC,UACAuB,mBAAmBE,MACnBP,aAAaO,MACbI,EAAEC,cAAcL,OAGpBrB"}