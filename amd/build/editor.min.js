/**
 * @module assignsubmission_onlyoffice/editor
 * @copyright  2024 Ascensio System SIA <integration@onlyoffice.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 **/
define("assignsubmission_onlyoffice/editor",["jquery"],(function($){var docEditor=null,openEditor=function(contextid,itemid,readonly){let tmplkey=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,format=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,templatetype=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if("undefined"!=typeof DocsAPI){var params={contextid:contextid,itemid:itemid};readonly&&(params.readonly=readonly),tmplkey&&(params.tmplkey=tmplkey),format&&(params.format=format),templatetype&&(params.templatetype=templatetype);var ajaxUrl=M.cfg.wwwroot+"/mod/assign/submission/onlyoffice/api/editorconfig.php";$.getJSON(ajaxUrl,params).done((function(config){docEditor=new DocsAPI.DocEditor("onlyoffice-editor",config),$("div#topofscroll").length>0&&$("div#topofscroll").addClass("assignsubmission-onlyoffice-display")}))}};const reopenEditor=function(contextid,itemid,readonly,format,templatetype){docEditor&&docEditor.destroyEditor();const generatekeyurl=M.cfg.wwwroot+"/mod/assign/submission/onlyoffice/api/generatekey.php";$.getJSON(generatekeyurl).done((function(key){document.querySelector("input[name='assignsubmission_onlyoffice_tmplkey']").value=key,openEditor(contextid,itemid,readonly,key,format,templatetype),$("#app-onlyoffice").show()}))};return{init:function(documentserverurl,contextid,itemid,readonly,tmplkey,templatetype){var docsapijs=document.createElement("script");docsapijs.type="text/javascript",$(docsapijs).appendTo("#app-onlyoffice"),$(docsapijs).on("load",(function(){if(tmplkey){let formatelement=$("input#id_assignsubmission_onlyoffice_format"),selectformat=$("select#id_assignsubmission_onlyoffice_format"),selecttemplatetype=$("select#id_assignsubmission_onlyoffice_template_type"),templatetypeelement=$("input#id_assignsubmission_onlyoffice_template_type"),enableapptoggle=$("input#id_assignsubmission_onlyoffice_enabled"),tmplkeyelement=document.querySelector("input[name='assignsubmission_onlyoffice_tmplkey']");if(0==enableapptoggle.length)return;enableapptoggle[0].checked&&templatetypeelement.length>0&&"custom"===templatetypeelement.val()&&openEditor(contextid,itemid,readonly,tmplkey),enableapptoggle.change((function(e){if(e.currentTarget.checked&&(formatelement.length>0&&"upload"!==formatelement.val()||selectformat.length>0&&"upload"!==selectformat.val())&&"custom"===selecttemplatetype)return null===docEditor&&openEditor(contextid,itemid,readonly,tmplkeyelement.val(),selectformat.val()),void $("#app-onlyoffice").show();$("#app-onlyoffice").hide()})),selectformat.length>0&&selectformat.change((function(e){"upload"===e.currentTarget.value?selecttemplatetype.val("custom").change():"custom"===selecttemplatetype.val()&&reopenEditor(contextid,itemid,readonly,selectformat.val(),selecttemplatetype.val())})),selecttemplatetype.change((function(e){"custom"===e.currentTarget.value&&"upload"!==selectformat.val()?reopenEditor(contextid,itemid,readonly,selectformat.val(),e.currentTarget.value):docEditor&&docEditor.destroyEditor()}))}else openEditor(contextid,itemid,readonly,null,null,templatetype)})),docsapijs.src=documentserverurl+"/web-apps/apps/api/documents/api.js"}}}));

//# sourceMappingURL=editor.min.js.map